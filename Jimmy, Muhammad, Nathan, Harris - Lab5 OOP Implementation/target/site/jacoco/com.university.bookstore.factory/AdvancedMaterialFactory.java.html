<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AdvancedMaterialFactory.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">bookstore-lab</a> &gt; <a href="index.source.html" class="el_package">com.university.bookstore.factory</a> &gt; <span class="el_source">AdvancedMaterialFactory.java</span></div><h1>AdvancedMaterialFactory.java</h1><pre class="source lang-java linenums">package com.university.bookstore.factory;

import java.util.Map;
import java.util.Objects;

import com.university.bookstore.model.AudioBook;
import com.university.bookstore.model.EBook;
import com.university.bookstore.model.Magazine;
import com.university.bookstore.model.Material;
import com.university.bookstore.model.Media;
import com.university.bookstore.model.PrintedBook;
import com.university.bookstore.model.VideoMaterial;

/**
 * Enhanced factory for creating Material instances with advanced validation and type-safe property extraction.
 * Demonstrates improved Factory pattern implementation with better error handling and validation.
 * 
 * &lt;p&gt;This factory extends the basic MaterialFactory with enhanced validation,
 * type-safe property extraction, and support for complex material configurations.&lt;/p&gt;
 * 
 * @author Navid Mohaghegh
 * @version 3.0
 * @since 2024-09-15
 */
<span class="nc" id="L25">public class AdvancedMaterialFactory {</span>
    
    /**
     * Creates a Material instance based on the specified type and properties.
     * 
     * @param type the material type
     * @param properties map of properties required for the material
     * @return the created Material instance
     * @throws IllegalArgumentException if type is null or properties are invalid
     * @throws NullPointerException if required properties are missing
     */
    public static Material createMaterial(String type, Map&lt;String, Object&gt; properties) {
<span class="nc" id="L37">        Objects.requireNonNull(type, &quot;Material type cannot be null&quot;);</span>
<span class="nc" id="L38">        Objects.requireNonNull(properties, &quot;Properties cannot be null&quot;);</span>
        
<span class="nc" id="L40">        String normalizedType = type.trim().toUpperCase();</span>
        
<span class="nc bnc" id="L42" title="All 6 branches missed.">        switch (normalizedType) {</span>
            case &quot;BOOK&quot;:
            case &quot;PRINTED_BOOK&quot;:
<span class="nc" id="L45">                return createPrintedBook(properties);</span>
            case &quot;EBOOK&quot;:
            case &quot;E_BOOK&quot;:
<span class="nc" id="L48">                return createEBook(properties);</span>
            case &quot;AUDIOBOOK&quot;:
            case &quot;AUDIO_BOOK&quot;:
<span class="nc" id="L51">                return createAudioBook(properties);</span>
            case &quot;VIDEO&quot;:
            case &quot;VIDEO_MATERIAL&quot;:
<span class="nc" id="L54">                return createVideoMaterial(properties);</span>
            case &quot;MAGAZINE&quot;:
<span class="nc" id="L56">                return createMagazine(properties);</span>
            default:
<span class="nc" id="L58">                throw new IllegalArgumentException(&quot;Unknown material type: &quot; + type);</span>
        }
    }
    
    /**
     * Creates a PrintedBook instance with enhanced validation.
     */
    private static PrintedBook createPrintedBook(Map&lt;String, Object&gt; properties) {
<span class="nc" id="L66">        return new PrintedBook(</span>
<span class="nc" id="L67">            getRequiredString(properties, &quot;id&quot;),</span>
<span class="nc" id="L68">            getRequiredString(properties, &quot;title&quot;),</span>
<span class="nc" id="L69">            getRequiredString(properties, &quot;author&quot;),</span>
<span class="nc" id="L70">            getRequiredDouble(properties, &quot;price&quot;),</span>
<span class="nc" id="L71">            getRequiredInt(properties, &quot;year&quot;),</span>
<span class="nc" id="L72">            getRequiredInt(properties, &quot;pages&quot;),</span>
<span class="nc" id="L73">            getRequiredString(properties, &quot;publisher&quot;),</span>
<span class="nc" id="L74">            getRequiredBoolean(properties, &quot;hardcover&quot;)</span>
        );
    }
    
    /**
     * Creates an EBook instance with enhanced validation.
     */
    private static EBook createEBook(Map&lt;String, Object&gt; properties) {
<span class="nc" id="L82">        return new EBook(</span>
<span class="nc" id="L83">            getRequiredString(properties, &quot;id&quot;),</span>
<span class="nc" id="L84">            getRequiredString(properties, &quot;title&quot;),</span>
<span class="nc" id="L85">            getRequiredString(properties, &quot;author&quot;),</span>
<span class="nc" id="L86">            getRequiredDouble(properties, &quot;price&quot;),</span>
<span class="nc" id="L87">            getRequiredInt(properties, &quot;year&quot;),</span>
<span class="nc" id="L88">            getRequiredString(properties, &quot;fileFormat&quot;),</span>
<span class="nc" id="L89">            getRequiredDouble(properties, &quot;fileSize&quot;),</span>
<span class="nc" id="L90">            getRequiredBoolean(properties, &quot;drmEnabled&quot;),</span>
<span class="nc" id="L91">            getRequiredInt(properties, &quot;wordCount&quot;),</span>
<span class="nc" id="L92">            getRequiredEnum(properties, &quot;quality&quot;, Media.MediaQuality.class)</span>
        );
    }
    
    /**
     * Creates an AudioBook instance with enhanced validation.
     */
    private static AudioBook createAudioBook(Map&lt;String, Object&gt; properties) {
<span class="nc" id="L100">        return new AudioBook(</span>
<span class="nc" id="L101">            getRequiredString(properties, &quot;id&quot;),</span>
<span class="nc" id="L102">            getRequiredString(properties, &quot;title&quot;),</span>
<span class="nc" id="L103">            getRequiredString(properties, &quot;author&quot;),</span>
<span class="nc" id="L104">            getRequiredString(properties, &quot;narrator&quot;),</span>
<span class="nc" id="L105">            getRequiredDouble(properties, &quot;price&quot;),</span>
<span class="nc" id="L106">            getRequiredInt(properties, &quot;year&quot;),</span>
<span class="nc" id="L107">            getRequiredInt(properties, &quot;duration&quot;),</span>
<span class="nc" id="L108">            getRequiredString(properties, &quot;format&quot;),</span>
<span class="nc" id="L109">            getRequiredDouble(properties, &quot;fileSize&quot;),</span>
<span class="nc" id="L110">            getRequiredEnum(properties, &quot;quality&quot;, Media.MediaQuality.class),</span>
<span class="nc" id="L111">            getRequiredString(properties, &quot;language&quot;),</span>
<span class="nc" id="L112">            getRequiredBoolean(properties, &quot;unabridged&quot;)</span>
        );
    }
    
    /**
     * Creates a VideoMaterial instance with enhanced validation.
     */
    private static VideoMaterial createVideoMaterial(Map&lt;String, Object&gt; properties) {
<span class="nc" id="L120">        return new VideoMaterial(</span>
<span class="nc" id="L121">            getRequiredString(properties, &quot;id&quot;),</span>
<span class="nc" id="L122">            getRequiredString(properties, &quot;title&quot;),</span>
<span class="nc" id="L123">            getRequiredString(properties, &quot;director&quot;),</span>
<span class="nc" id="L124">            getRequiredDouble(properties, &quot;price&quot;),</span>
<span class="nc" id="L125">            getRequiredInt(properties, &quot;year&quot;),</span>
<span class="nc" id="L126">            getRequiredInt(properties, &quot;duration&quot;),</span>
<span class="nc" id="L127">            getRequiredString(properties, &quot;format&quot;),</span>
<span class="nc" id="L128">            getRequiredDouble(properties, &quot;fileSize&quot;),</span>
<span class="nc" id="L129">            getRequiredEnum(properties, &quot;quality&quot;, Media.MediaQuality.class),</span>
<span class="nc" id="L130">            getRequiredEnum(properties, &quot;videoType&quot;, VideoMaterial.VideoType.class),</span>
<span class="nc" id="L131">            getRequiredString(properties, &quot;rating&quot;),</span>
<span class="nc" id="L132">            getRequiredStringList(properties, &quot;cast&quot;),</span>
<span class="nc" id="L133">            getRequiredBoolean(properties, &quot;subtitlesAvailable&quot;),</span>
<span class="nc" id="L134">            getRequiredString(properties, &quot;aspectRatio&quot;)</span>
        );
    }
    
    /**
     * Creates a Magazine instance with enhanced validation.
     */
    private static Magazine createMagazine(Map&lt;String, Object&gt; properties) {
<span class="nc" id="L142">        return new Magazine(</span>
<span class="nc" id="L143">            getRequiredString(properties, &quot;id&quot;),</span>
<span class="nc" id="L144">            getRequiredString(properties, &quot;title&quot;),</span>
<span class="nc" id="L145">            getRequiredString(properties, &quot;publisher&quot;),</span>
<span class="nc" id="L146">            getRequiredDouble(properties, &quot;price&quot;),</span>
<span class="nc" id="L147">            getRequiredInt(properties, &quot;year&quot;),</span>
<span class="nc" id="L148">            getRequiredInt(properties, &quot;issue&quot;),</span>
<span class="nc" id="L149">            getRequiredString(properties, &quot;frequency&quot;),</span>
<span class="nc" id="L150">            getRequiredString(properties, &quot;category&quot;)</span>
        );
    }
    
    // Enhanced helper methods for type-safe property extraction
    
    /**
     * Gets a required string property with validation.
     */
    private static String getRequiredString(Map&lt;String, Object&gt; properties, String key) {
<span class="nc" id="L160">        Object value = properties.get(key);</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L162">            throw new IllegalArgumentException(&quot;Required property missing: &quot; + key);</span>
        }
<span class="nc" id="L164">        String str = value.toString().trim();</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">        if (str.isEmpty()) {</span>
<span class="nc" id="L166">            throw new IllegalArgumentException(&quot;Required property cannot be empty: &quot; + key);</span>
        }
<span class="nc" id="L168">        return str;</span>
    }
    
    /**
     * Gets a required double property with validation.
     */
    private static double getRequiredDouble(Map&lt;String, Object&gt; properties, String key) {
<span class="nc" id="L175">        Object value = properties.get(key);</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L177">            throw new IllegalArgumentException(&quot;Required property missing: &quot; + key);</span>
        }
<span class="nc bnc" id="L179" title="All 2 branches missed.">        if (value instanceof Number) {</span>
<span class="nc" id="L180">            double result = ((Number) value).doubleValue();</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">            if (result &lt; 0) {</span>
<span class="nc" id="L182">                throw new IllegalArgumentException(&quot;Property &quot; + key + &quot; must be non-negative: &quot; + result);</span>
            }
<span class="nc" id="L184">            return result;</span>
        }
<span class="nc" id="L186">        throw new IllegalArgumentException(&quot;Property &quot; + key + &quot; must be a number&quot;);</span>
    }
    
    /**
     * Gets a required integer property with validation.
     */
    private static int getRequiredInt(Map&lt;String, Object&gt; properties, String key) {
<span class="nc" id="L193">        Object value = properties.get(key);</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L195">            throw new IllegalArgumentException(&quot;Required property missing: &quot; + key);</span>
        }
<span class="nc bnc" id="L197" title="All 2 branches missed.">        if (value instanceof Number) {</span>
<span class="nc" id="L198">            int result = ((Number) value).intValue();</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">            if (result &lt; 0) {</span>
<span class="nc" id="L200">                throw new IllegalArgumentException(&quot;Property &quot; + key + &quot; must be non-negative: &quot; + result);</span>
            }
<span class="nc" id="L202">            return result;</span>
        }
<span class="nc" id="L204">        throw new IllegalArgumentException(&quot;Property &quot; + key + &quot; must be a number&quot;);</span>
    }
    
    /**
     * Gets a required boolean property with validation.
     */
    private static boolean getRequiredBoolean(Map&lt;String, Object&gt; properties, String key) {
<span class="nc" id="L211">        Object value = properties.get(key);</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L213">            throw new IllegalArgumentException(&quot;Required property missing: &quot; + key);</span>
        }
<span class="nc bnc" id="L215" title="All 2 branches missed.">        if (value instanceof Boolean) {</span>
<span class="nc" id="L216">            return (Boolean) value;</span>
        }
<span class="nc" id="L218">        throw new IllegalArgumentException(&quot;Property &quot; + key + &quot; must be a boolean&quot;);</span>
    }
    
    /**
     * Gets a required enum property with validation.
     */
    private static &lt;T extends Enum&lt;T&gt;&gt; T getRequiredEnum(Map&lt;String, Object&gt; properties, 
                                                       String key, Class&lt;T&gt; enumClass) {
<span class="nc" id="L226">        Object value = properties.get(key);</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L228">            throw new IllegalArgumentException(&quot;Required property missing: &quot; + key);</span>
        }
<span class="nc bnc" id="L230" title="All 2 branches missed.">        if (value instanceof String) {</span>
            try {
<span class="nc" id="L232">                return Enum.valueOf(enumClass, value.toString().toUpperCase());</span>
<span class="nc" id="L233">            } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L234">                throw new IllegalArgumentException(&quot;Property &quot; + key + &quot; must be a valid &quot; + </span>
<span class="nc" id="L235">                                                 enumClass.getSimpleName() + &quot;: &quot; + value);</span>
            }
        }
<span class="nc" id="L238">        throw new IllegalArgumentException(&quot;Property &quot; + key + &quot; must be a string&quot;);</span>
    }
    
    /**
     * Gets a required string list property with validation.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    private static java.util.List&lt;String&gt; getRequiredStringList(Map&lt;String, Object&gt; properties, String key) {
<span class="nc" id="L246">        Object value = properties.get(key);</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L248">            throw new IllegalArgumentException(&quot;Required property missing: &quot; + key);</span>
        }
<span class="nc bnc" id="L250" title="All 2 branches missed.">        if (value instanceof java.util.List) {</span>
<span class="nc" id="L251">            return (java.util.List&lt;String&gt;) value;</span>
        }
<span class="nc bnc" id="L253" title="All 2 branches missed.">        if (value instanceof String) {</span>
<span class="nc" id="L254">            String str = value.toString().trim();</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">            if (str.isEmpty()) {</span>
<span class="nc" id="L256">                return java.util.Arrays.asList();</span>
            }
<span class="nc" id="L258">            return java.util.Arrays.asList(str.split(&quot;,&quot;));</span>
        }
<span class="nc" id="L260">        throw new IllegalArgumentException(&quot;Property &quot; + key + &quot; must be a list or string&quot;);</span>
    }
    
    /**
     * Validates that all required properties are present.
     * 
     * @param type the material type to validate
     * @param properties the properties map to validate
     */
    public static void validateRequiredProperties(String type, Map&lt;String, Object&gt; properties) {
<span class="nc" id="L270">        String normalizedType = type.trim().toUpperCase();</span>
        
<span class="nc bnc" id="L272" title="All 6 branches missed.">        switch (normalizedType) {</span>
            case &quot;BOOK&quot;:
            case &quot;PRINTED_BOOK&quot;:
<span class="nc" id="L275">                validatePrintedBookProperties(properties);</span>
<span class="nc" id="L276">                break;</span>
            case &quot;EBOOK&quot;:
            case &quot;E_BOOK&quot;:
<span class="nc" id="L279">                validateEBookProperties(properties);</span>
<span class="nc" id="L280">                break;</span>
            case &quot;AUDIOBOOK&quot;:
            case &quot;AUDIO_BOOK&quot;:
<span class="nc" id="L283">                validateAudioBookProperties(properties);</span>
<span class="nc" id="L284">                break;</span>
            case &quot;VIDEO&quot;:
            case &quot;VIDEO_MATERIAL&quot;:
<span class="nc" id="L287">                validateVideoMaterialProperties(properties);</span>
<span class="nc" id="L288">                break;</span>
            case &quot;MAGAZINE&quot;:
<span class="nc" id="L290">                validateMagazineProperties(properties);</span>
<span class="nc" id="L291">                break;</span>
            default:
<span class="nc" id="L293">                throw new IllegalArgumentException(&quot;Unknown material type: &quot; + type);</span>
        }
<span class="nc" id="L295">    }</span>
    
    private static void validatePrintedBookProperties(Map&lt;String, Object&gt; properties) {
<span class="nc" id="L298">        String[] required = {&quot;id&quot;, &quot;title&quot;, &quot;author&quot;, &quot;price&quot;, &quot;year&quot;, &quot;pages&quot;, &quot;publisher&quot;, &quot;hardcover&quot;};</span>
<span class="nc" id="L299">        validateRequiredKeys(properties, required);</span>
<span class="nc" id="L300">    }</span>
    
    private static void validateEBookProperties(Map&lt;String, Object&gt; properties) {
<span class="nc" id="L303">        String[] required = {&quot;id&quot;, &quot;title&quot;, &quot;author&quot;, &quot;price&quot;, &quot;year&quot;, &quot;fileFormat&quot;, &quot;fileSize&quot;, &quot;drmEnabled&quot;, &quot;wordCount&quot;, &quot;quality&quot;};</span>
<span class="nc" id="L304">        validateRequiredKeys(properties, required);</span>
<span class="nc" id="L305">    }</span>
    
    private static void validateAudioBookProperties(Map&lt;String, Object&gt; properties) {
<span class="nc" id="L308">        String[] required = {&quot;id&quot;, &quot;title&quot;, &quot;author&quot;, &quot;narrator&quot;, &quot;price&quot;, &quot;year&quot;, &quot;duration&quot;, &quot;format&quot;, &quot;fileSize&quot;, &quot;quality&quot;, &quot;language&quot;, &quot;unabridged&quot;};</span>
<span class="nc" id="L309">        validateRequiredKeys(properties, required);</span>
<span class="nc" id="L310">    }</span>
    
    private static void validateVideoMaterialProperties(Map&lt;String, Object&gt; properties) {
<span class="nc" id="L313">        String[] required = {&quot;id&quot;, &quot;title&quot;, &quot;director&quot;, &quot;price&quot;, &quot;year&quot;, &quot;duration&quot;, &quot;format&quot;, &quot;fileSize&quot;, &quot;quality&quot;, &quot;videoType&quot;, &quot;rating&quot;, &quot;cast&quot;, &quot;subtitlesAvailable&quot;, &quot;aspectRatio&quot;};</span>
<span class="nc" id="L314">        validateRequiredKeys(properties, required);</span>
<span class="nc" id="L315">    }</span>
    
    private static void validateMagazineProperties(Map&lt;String, Object&gt; properties) {
<span class="nc" id="L318">        String[] required = {&quot;id&quot;, &quot;title&quot;, &quot;publisher&quot;, &quot;price&quot;, &quot;year&quot;, &quot;issue&quot;, &quot;frequency&quot;, &quot;category&quot;};</span>
<span class="nc" id="L319">        validateRequiredKeys(properties, required);</span>
<span class="nc" id="L320">    }</span>
    
    private static void validateRequiredKeys(Map&lt;String, Object&gt; properties, String[] requiredKeys) {
<span class="nc bnc" id="L323" title="All 2 branches missed.">        for (String key : requiredKeys) {</span>
<span class="nc bnc" id="L324" title="All 2 branches missed.">            if (!properties.containsKey(key)) {</span>
<span class="nc" id="L325">                throw new IllegalArgumentException(&quot;Required property missing: &quot; + key);</span>
            }
        }
<span class="nc" id="L328">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>