<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MaterialFactory.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">bookstore-lab</a> &gt; <a href="index.source.html" class="el_package">com.university.bookstore.factory</a> &gt; <span class="el_source">MaterialFactory.java</span></div><h1>MaterialFactory.java</h1><pre class="source lang-java linenums">package com.university.bookstore.factory;

import java.util.Map;

import com.university.bookstore.model.AudioBook;
import com.university.bookstore.model.EBook;
import com.university.bookstore.model.Magazine;
import com.university.bookstore.model.Material;
import com.university.bookstore.model.Media;
import com.university.bookstore.model.PrintedBook;
import com.university.bookstore.model.VideoMaterial;

/**
 * Factory class for creating Material instances.
 * Demonstrates the Factory pattern by providing a centralized
 * way to create different types of materials without exposing
 * their constructors directly.
 * 
 * &lt;p&gt;This factory supports creating all material types including
 * the new EBook class, with proper validation and error handling.&lt;/p&gt;
 * 
 * @author Navid Mohaghegh
 * @version 2.0
 * @since 2024-09-15
 */
<span class="nc" id="L26">public class MaterialFactory {</span>
    
    /**
     * Creates a Material instance based on the specified type and properties.
     * 
     * @param type the material type
     * @param properties map of properties required for the material
     * @return the created Material instance
     * @throws IllegalArgumentException if type is null or properties are invalid
     * @throws NullPointerException if required properties are missing
     */
    public static Material createMaterial(String type, Map&lt;String, Object&gt; properties) {
<span class="fc bfc" id="L38" title="All 2 branches covered.">        if (type == null) {</span>
<span class="fc" id="L39">            throw new NullPointerException(&quot;Material type cannot be null&quot;);</span>
        }
<span class="fc bfc" id="L41" title="All 2 branches covered.">        if (properties == null) {</span>
<span class="fc" id="L42">            throw new NullPointerException(&quot;Properties cannot be null&quot;);</span>
        }
        
<span class="fc" id="L45">        String normalizedType = type.trim().toUpperCase();</span>
        
<span class="fc bfc" id="L47" title="All 6 branches covered.">        switch (normalizedType) {</span>
            case &quot;BOOK&quot;:
            case &quot;PRINTED_BOOK&quot;:
<span class="fc" id="L50">                return createPrintedBook(properties);</span>
            case &quot;MAGAZINE&quot;:
<span class="fc" id="L52">                return createMagazine(properties);</span>
            case &quot;AUDIO_BOOK&quot;:
            case &quot;AUDIOBOOK&quot;:
<span class="fc" id="L55">                return createAudioBook(properties);</span>
            case &quot;VIDEO&quot;:
            case &quot;VIDEO_MATERIAL&quot;:
<span class="fc" id="L58">                return createVideoMaterial(properties);</span>
            case &quot;EBOOK&quot;:
            case &quot;E_BOOK&quot;:
<span class="fc" id="L61">                return createEBook(properties);</span>
            default:
<span class="fc" id="L63">                throw new IllegalArgumentException(&quot;Unsupported material type: &quot; + type);</span>
        }
    }
    
    /**
     * Creates a PrintedBook instance.
     */
    private static PrintedBook createPrintedBook(Map&lt;String, Object&gt; properties) {
<span class="fc" id="L71">        String isbn = getRequiredString(properties, &quot;isbn&quot;);</span>
<span class="fc" id="L72">        String title = getRequiredString(properties, &quot;title&quot;);</span>
<span class="fc" id="L73">        String author = getRequiredString(properties, &quot;author&quot;);</span>
<span class="fc" id="L74">        double price = getRequiredDouble(properties, &quot;price&quot;);</span>
<span class="fc" id="L75">        int year = getRequiredInteger(properties, &quot;year&quot;);</span>
<span class="fc" id="L76">        int pages = getRequiredInteger(properties, &quot;pages&quot;);</span>
<span class="fc" id="L77">        String publisher = getOptionalString(properties, &quot;publisher&quot;, &quot;Unknown&quot;);</span>
<span class="fc" id="L78">        boolean hardcover = getOptionalBoolean(properties, &quot;hardcover&quot;, false);</span>
        
<span class="fc" id="L80">        return new PrintedBook(isbn, title, author, price, year, pages, publisher, hardcover);</span>
    }
    
    /**
     * Creates a Magazine instance.
     */
    private static Magazine createMagazine(Map&lt;String, Object&gt; properties) {
<span class="fc" id="L87">        String issn = getRequiredString(properties, &quot;issn&quot;);</span>
<span class="fc" id="L88">        String title = getRequiredString(properties, &quot;title&quot;);</span>
<span class="fc" id="L89">        String publisher = getRequiredString(properties, &quot;publisher&quot;);</span>
<span class="fc" id="L90">        double price = getRequiredDouble(properties, &quot;price&quot;);</span>
<span class="fc" id="L91">        int year = getRequiredInteger(properties, &quot;year&quot;);</span>
<span class="fc" id="L92">        int issue = getRequiredInteger(properties, &quot;issue&quot;);</span>
<span class="fc" id="L93">        String frequency = getOptionalString(properties, &quot;frequency&quot;, &quot;Monthly&quot;);</span>
<span class="fc" id="L94">        String category = getOptionalString(properties, &quot;category&quot;, &quot;General&quot;);</span>
        
<span class="fc" id="L96">        return new Magazine(issn, title, publisher, price, year, issue, frequency, category);</span>
    }
    
    /**
     * Creates an AudioBook instance.
     * Note: This is a simplified version for demonstration purposes.
     */
    private static AudioBook createAudioBook(Map&lt;String, Object&gt; properties) {
<span class="fc" id="L104">        String isbn = getRequiredString(properties, &quot;isbn&quot;);</span>
<span class="fc" id="L105">        String title = getRequiredString(properties, &quot;title&quot;);</span>
<span class="fc" id="L106">        String author = getRequiredString(properties, &quot;author&quot;);</span>
<span class="fc" id="L107">        String narrator = getRequiredString(properties, &quot;narrator&quot;);</span>
<span class="fc" id="L108">        double price = getRequiredDouble(properties, &quot;price&quot;);</span>
<span class="fc" id="L109">        int year = getRequiredInteger(properties, &quot;year&quot;);</span>
<span class="fc" id="L110">        int duration = getRequiredInteger(properties, &quot;duration&quot;);</span>
<span class="fc" id="L111">        String format = getOptionalString(properties, &quot;format&quot;, &quot;MP3&quot;);</span>
<span class="fc" id="L112">        double fileSize = getOptionalDouble(properties, &quot;fileSize&quot;, 100.0);</span>
<span class="fc" id="L113">        Media.MediaQuality quality = getRequiredMediaQuality(properties, &quot;quality&quot;);</span>
<span class="fc" id="L114">        String language = getOptionalString(properties, &quot;language&quot;, &quot;English&quot;);</span>
<span class="fc" id="L115">        boolean unabridged = getOptionalBoolean(properties, &quot;unabridged&quot;, true);</span>
        
<span class="fc" id="L117">        return new AudioBook(isbn, title, author, narrator, price, year, duration, </span>
                           format, fileSize, quality, language, unabridged);
    }
    
    /**
     * Creates a VideoMaterial instance.
     * Note: This is a simplified version for demonstration purposes.
     */
    private static VideoMaterial createVideoMaterial(Map&lt;String, Object&gt; properties) {
<span class="fc" id="L126">        String id = getRequiredString(properties, &quot;id&quot;);</span>
<span class="fc" id="L127">        String title = getRequiredString(properties, &quot;title&quot;);</span>
<span class="fc" id="L128">        String director = getRequiredString(properties, &quot;director&quot;);</span>
<span class="fc" id="L129">        double price = getRequiredDouble(properties, &quot;price&quot;);</span>
<span class="fc" id="L130">        int year = getRequiredInteger(properties, &quot;year&quot;);</span>
<span class="fc" id="L131">        int duration = getRequiredInteger(properties, &quot;duration&quot;);</span>
<span class="fc" id="L132">        String format = getOptionalString(properties, &quot;format&quot;, &quot;MP4&quot;);</span>
<span class="fc" id="L133">        double fileSize = getOptionalDouble(properties, &quot;fileSize&quot;, 1000.0);</span>
<span class="fc" id="L134">        Media.MediaQuality quality = getRequiredMediaQuality(properties, &quot;quality&quot;);</span>
<span class="fc" id="L135">        VideoMaterial.VideoType videoType = getRequiredVideoType(properties, &quot;videoType&quot;);</span>
<span class="fc" id="L136">        String rating = getOptionalString(properties, &quot;rating&quot;, &quot;PG&quot;);</span>
<span class="fc" id="L137">        java.util.List&lt;String&gt; cast = getOptionalStringList(properties, &quot;cast&quot;);</span>
<span class="fc" id="L138">        boolean subtitlesAvailable = getOptionalBoolean(properties, &quot;subtitlesAvailable&quot;, false);</span>
<span class="fc" id="L139">        String aspectRatio = getOptionalString(properties, &quot;aspectRatio&quot;, &quot;16:9&quot;);</span>
        
<span class="fc" id="L141">        return new VideoMaterial(id, title, director, price, year, duration, format, </span>
                               fileSize, quality, videoType, rating, cast, 
                               subtitlesAvailable, aspectRatio);
    }
    
    /**
     * Creates an EBook instance.
     */
    private static EBook createEBook(Map&lt;String, Object&gt; properties) {
<span class="fc" id="L150">        String id = getRequiredString(properties, &quot;id&quot;);</span>
<span class="fc" id="L151">        String title = getRequiredString(properties, &quot;title&quot;);</span>
<span class="fc" id="L152">        String author = getRequiredString(properties, &quot;author&quot;);</span>
<span class="fc" id="L153">        double price = getRequiredDouble(properties, &quot;price&quot;);</span>
<span class="fc" id="L154">        int year = getRequiredInteger(properties, &quot;year&quot;);</span>
<span class="fc" id="L155">        String fileFormat = getRequiredString(properties, &quot;fileFormat&quot;);</span>
<span class="fc" id="L156">        double fileSize = getRequiredDouble(properties, &quot;fileSize&quot;);</span>
<span class="fc" id="L157">        boolean drmEnabled = getRequiredBoolean(properties, &quot;drmEnabled&quot;);</span>
<span class="fc" id="L158">        int wordCount = getRequiredInteger(properties, &quot;wordCount&quot;);</span>
<span class="fc" id="L159">        Media.MediaQuality quality = getRequiredMediaQuality(properties, &quot;quality&quot;);</span>
        
<span class="fc" id="L161">        return new EBook(id, title, author, price, year, fileFormat, fileSize, </span>
                        drmEnabled, wordCount, quality);
    }
    
    // Helper methods for extracting and validating properties
    
    private static String getRequiredString(Map&lt;String, Object&gt; properties, String key) {
<span class="fc" id="L168">        Object value = properties.get(key);</span>
<span class="fc bfc" id="L169" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L170">            throw new NullPointerException(&quot;Required property '&quot; + key + &quot;' is missing&quot;);</span>
        }
<span class="pc bpc" id="L172" title="1 of 2 branches missed.">        if (!(value instanceof String)) {</span>
<span class="nc" id="L173">            throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a String, got: &quot; + value.getClass().getSimpleName());</span>
        }
<span class="fc" id="L175">        String str = (String) value;</span>
<span class="fc bfc" id="L176" title="All 2 branches covered.">        if (str.trim().isEmpty()) {</span>
<span class="fc" id="L177">            throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' cannot be empty&quot;);</span>
        }
<span class="fc" id="L179">        return str.trim();</span>
    }
    
    private static double getRequiredDouble(Map&lt;String, Object&gt; properties, String key) {
<span class="fc" id="L183">        Object value = properties.get(key);</span>
<span class="pc bpc" id="L184" title="1 of 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L185">            throw new NullPointerException(&quot;Required property '&quot; + key + &quot;' is missing&quot;);</span>
        }
<span class="fc bfc" id="L187" title="All 2 branches covered.">        if (value instanceof Number) {</span>
<span class="fc" id="L188">            return ((Number) value).doubleValue();</span>
        }
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">        if (value instanceof String) {</span>
            try {
<span class="fc" id="L192">                return Double.parseDouble((String) value);</span>
<span class="fc" id="L193">            } catch (NumberFormatException e) {</span>
<span class="fc" id="L194">                throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a valid number, got: &quot; + value);</span>
            }
        }
<span class="nc" id="L197">        throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a number, got: &quot; + value.getClass().getSimpleName());</span>
    }
    
    private static int getRequiredInteger(Map&lt;String, Object&gt; properties, String key) {
<span class="fc" id="L201">        Object value = properties.get(key);</span>
<span class="pc bpc" id="L202" title="1 of 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L203">            throw new NullPointerException(&quot;Required property '&quot; + key + &quot;' is missing&quot;);</span>
        }
<span class="fc bfc" id="L205" title="All 2 branches covered.">        if (value instanceof Number) {</span>
<span class="fc" id="L206">            return ((Number) value).intValue();</span>
        }
<span class="pc bpc" id="L208" title="1 of 2 branches missed.">        if (value instanceof String) {</span>
            try {
<span class="fc" id="L210">                return Integer.parseInt((String) value);</span>
<span class="nc" id="L211">            } catch (NumberFormatException e) {</span>
<span class="nc" id="L212">                throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a valid integer, got: &quot; + value);</span>
            }
        }
<span class="nc" id="L215">        throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be an integer, got: &quot; + value.getClass().getSimpleName());</span>
    }
    
    private static boolean getRequiredBoolean(Map&lt;String, Object&gt; properties, String key) {
<span class="fc" id="L219">        Object value = properties.get(key);</span>
<span class="pc bpc" id="L220" title="1 of 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L221">            throw new NullPointerException(&quot;Required property '&quot; + key + &quot;' is missing&quot;);</span>
        }
<span class="fc bfc" id="L223" title="All 2 branches covered.">        if (value instanceof Boolean) {</span>
<span class="fc" id="L224">            return (Boolean) value;</span>
        }
<span class="pc bpc" id="L226" title="1 of 2 branches missed.">        if (value instanceof String) {</span>
<span class="fc" id="L227">            String str = ((String) value).trim().toLowerCase();</span>
<span class="pc bpc" id="L228" title="5 of 6 branches missed.">            if (&quot;true&quot;.equals(str) || &quot;1&quot;.equals(str) || &quot;yes&quot;.equals(str)) {</span>
<span class="fc" id="L229">                return true;</span>
            }
<span class="nc bnc" id="L231" title="All 6 branches missed.">            if (&quot;false&quot;.equals(str) || &quot;0&quot;.equals(str) || &quot;no&quot;.equals(str)) {</span>
<span class="nc" id="L232">                return false;</span>
            }
<span class="nc" id="L234">            throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a valid boolean, got: &quot; + value);</span>
        }
<span class="nc" id="L236">        throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a boolean, got: &quot; + value.getClass().getSimpleName());</span>
    }
    
    private static Media.MediaQuality getRequiredMediaQuality(Map&lt;String, Object&gt; properties, String key) {
<span class="fc" id="L240">        Object value = properties.get(key);</span>
<span class="pc bpc" id="L241" title="1 of 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L242">            throw new NullPointerException(&quot;Required property '&quot; + key + &quot;' is missing&quot;);</span>
        }
<span class="fc bfc" id="L244" title="All 2 branches covered.">        if (value instanceof Media.MediaQuality) {</span>
<span class="fc" id="L245">            return (Media.MediaQuality) value;</span>
        }
<span class="pc bpc" id="L247" title="1 of 2 branches missed.">        if (value instanceof String) {</span>
            try {
<span class="fc" id="L249">                return Media.MediaQuality.valueOf(((String) value).trim().toUpperCase());</span>
<span class="nc" id="L250">            } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L251">                throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a valid MediaQuality, got: &quot; + value);</span>
            }
        }
<span class="nc" id="L254">        throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a MediaQuality, got: &quot; + value.getClass().getSimpleName());</span>
    }
    
    private static String getOptionalString(Map&lt;String, Object&gt; properties, String key, String defaultValue) {
<span class="fc" id="L258">        Object value = properties.get(key);</span>
<span class="fc bfc" id="L259" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L260">            return defaultValue;</span>
        }
<span class="pc bpc" id="L262" title="1 of 2 branches missed.">        if (!(value instanceof String)) {</span>
<span class="nc" id="L263">            throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a String, got: &quot; + value.getClass().getSimpleName());</span>
        }
<span class="fc" id="L265">        String str = (String) value;</span>
<span class="pc bpc" id="L266" title="1 of 2 branches missed.">        return str.trim().isEmpty() ? defaultValue : str.trim();</span>
    }
    
    private static boolean getOptionalBoolean(Map&lt;String, Object&gt; properties, String key, boolean defaultValue) {
<span class="fc" id="L270">        Object value = properties.get(key);</span>
<span class="fc bfc" id="L271" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L272">            return defaultValue;</span>
        }
<span class="pc bpc" id="L274" title="1 of 2 branches missed.">        if (value instanceof Boolean) {</span>
<span class="fc" id="L275">            return (Boolean) value;</span>
        }
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (value instanceof String) {</span>
<span class="nc" id="L278">            String str = ((String) value).trim().toLowerCase();</span>
<span class="nc bnc" id="L279" title="All 6 branches missed.">            if (&quot;true&quot;.equals(str) || &quot;1&quot;.equals(str) || &quot;yes&quot;.equals(str)) {</span>
<span class="nc" id="L280">                return true;</span>
            }
<span class="nc bnc" id="L282" title="All 6 branches missed.">            if (&quot;false&quot;.equals(str) || &quot;0&quot;.equals(str) || &quot;no&quot;.equals(str)) {</span>
<span class="nc" id="L283">                return false;</span>
            }
<span class="nc" id="L285">            throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a valid boolean, got: &quot; + value);</span>
        }
<span class="nc" id="L287">        throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a boolean, got: &quot; + value.getClass().getSimpleName());</span>
    }
    
    private static double getOptionalDouble(Map&lt;String, Object&gt; properties, String key, double defaultValue) {
<span class="fc" id="L291">        Object value = properties.get(key);</span>
<span class="pc bpc" id="L292" title="1 of 2 branches missed.">        if (value == null) {</span>
<span class="fc" id="L293">            return defaultValue;</span>
        }
<span class="nc bnc" id="L295" title="All 2 branches missed.">        if (value instanceof Number) {</span>
<span class="nc" id="L296">            return ((Number) value).doubleValue();</span>
        }
<span class="nc bnc" id="L298" title="All 2 branches missed.">        if (value instanceof String) {</span>
            try {
<span class="nc" id="L300">                return Double.parseDouble((String) value);</span>
<span class="nc" id="L301">            } catch (NumberFormatException e) {</span>
<span class="nc" id="L302">                throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a valid number, got: &quot; + value);</span>
            }
        }
<span class="nc" id="L305">        throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a number, got: &quot; + value.getClass().getSimpleName());</span>
    }
    
    private static VideoMaterial.VideoType getRequiredVideoType(Map&lt;String, Object&gt; properties, String key) {
<span class="fc" id="L309">        Object value = properties.get(key);</span>
<span class="pc bpc" id="L310" title="1 of 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L311">            throw new NullPointerException(&quot;Required property '&quot; + key + &quot;' is missing&quot;);</span>
        }
<span class="pc bpc" id="L313" title="1 of 2 branches missed.">        if (value instanceof VideoMaterial.VideoType) {</span>
<span class="nc" id="L314">            return (VideoMaterial.VideoType) value;</span>
        }
<span class="pc bpc" id="L316" title="1 of 2 branches missed.">        if (value instanceof String) {</span>
            try {
<span class="fc" id="L318">                return VideoMaterial.VideoType.valueOf(((String) value).trim().toUpperCase());</span>
<span class="nc" id="L319">            } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L320">                throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a valid VideoType, got: &quot; + value);</span>
            }
        }
<span class="nc" id="L323">        throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a VideoType, got: &quot; + value.getClass().getSimpleName());</span>
    }
    
    @SuppressWarnings(&quot;unchecked&quot;)
    private static java.util.List&lt;String&gt; getOptionalStringList(Map&lt;String, Object&gt; properties, String key) {
<span class="fc" id="L328">        Object value = properties.get(key);</span>
<span class="pc bpc" id="L329" title="1 of 2 branches missed.">        if (value == null) {</span>
<span class="fc" id="L330">            return java.util.Arrays.asList();</span>
        }
<span class="nc bnc" id="L332" title="All 2 branches missed.">        if (value instanceof java.util.List) {</span>
<span class="nc" id="L333">            return (java.util.List&lt;String&gt;) value;</span>
        }
<span class="nc bnc" id="L335" title="All 2 branches missed.">        if (value instanceof String) {</span>
<span class="nc" id="L336">            String str = (String) value;</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">            if (str.trim().isEmpty()) {</span>
<span class="nc" id="L338">                return java.util.Arrays.asList();</span>
            }
<span class="nc" id="L340">            return java.util.Arrays.asList(str.split(&quot;,&quot;));</span>
        }
<span class="nc" id="L342">        throw new IllegalArgumentException(&quot;Property '&quot; + key + &quot;' must be a List&lt;String&gt; or String, got: &quot; + value.getClass().getSimpleName());</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>